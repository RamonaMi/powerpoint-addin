<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerPoint ã‚­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆã‚¢ãƒ‰ã‚ªãƒ³</title>
    
    <!-- Office.js ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            padding: 15px;
            font-size: 14px;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h3 {
            color: #1e3c72;
            margin-bottom: 12px;
            font-size: 16px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 5px;
        }
        
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: bold;
            color: #333;
            font-size: 12px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 5px rgba(30, 60, 114, 0.3);
        }
        
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .btn {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin: 8px 0;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 11px;
            width: auto;
            display: inline-block;
            margin: 2px;
        }
        
        .message-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #1e3c72;
        }
        
        .message-type {
            background: #1e3c72;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .message-text {
            font-size: 13px;
            font-weight: bold;
            color: #2c3e50;
            line-height: 1.3;
            margin-bottom: 5px;
        }
        
        .message-description {
            font-size: 10px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .current-slide-info {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
        }
        
        .status-bar {
            background: #28a745;
            color: white;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            font-size: 11px;
            margin: 10px 0;
            display: none;
        }
        
        .status-bar.error {
            background: #dc3545;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3c72;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .slide-preview {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            min-height: 80px;
            margin: 10px 0;
            font-size: 11px;
            color: #666;
        }
        
        .templates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }
        
        .template-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 11px;
            transition: all 0.2s ease;
        }
        
        .template-item:hover {
            background: #e9ecef;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ ã‚­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ</h1>
        <p>PowerPointçµ±åˆç‰ˆ - ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è‡ªå‹•ä½œæˆ</p>
    </div>
    
    <div class="current-slide-info" id="currentSlideInfo">
        <strong>ğŸ“„ ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰:</strong> <span id="slideNumber">1</span> / <span id="totalSlides">1</span><br>
        <strong>ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«:</strong> <span id="slideTitle">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
    
    <div class="status-bar" id="statusBar"></div>
    
    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="section">
        <h3>âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
        <div class="quick-actions">
            <button class="btn btn-success btn-small" onclick="analyzeCurrentSlide()">ğŸ“Š ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æ</button>
            <button class="btn btn-secondary btn-small" onclick="analyzeAllSlides()">ğŸ“‹ å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æ</button>
            <button class="btn btn-warning btn-small" onclick="insertMessageToSlide()">â• ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ¿å…¥</button>
            <button class="btn btn-small" onclick="createNewSlideWithMessage()">ğŸ“„ æ–°ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆ</button>
        </div>
    </div>
    
    <!-- ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±è¡¨ç¤º -->
    <div class="section" id="slideAnalysisSection" style="display: none;">
        <h3>ğŸ” ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æçµæœ</h3>
        <div id="slideAnalysisResult"></div>
    </div>
    
    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ -->
    <div class="section">
        <h3>ğŸ’¡ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆè¨­å®š</h3>
        
        <div class="input-group">
            <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—:</label>
            <select id="messageType">
                <option value="executive">ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼</option>
                <option value="problem">èª²é¡Œãƒ»å•é¡Œæèµ·</option>
                <option value="solution">ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ææ¡ˆ</option>
                <option value="benefit">ãƒ™ãƒãƒ•ã‚£ãƒƒãƒˆãƒ»åŠ¹æœ</option>
                <option value="action">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³</option>
                <option value="closing">ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>å¯¾è±¡è€…:</label>
            <select id="targetAudience">
                <option value="executives">çµŒå–¶é™£</option>
                <option value="managers">ç®¡ç†è·</option>
                <option value="team">ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼</option>
                <option value="clients">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</option>
                <option value="stakeholders">ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</label>
            <input type="text" id="keywords" placeholder="ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›">
        </div>
        
        <button class="btn" onclick="generateMessage()">ğŸš€ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ</button>
    </div>
    
    <!-- ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="section" id="generatedMessageSection" style="display: none;">
        <h3>âœ¨ ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
        <div id="generatedMessages"></div>
    </div>
    
    <!-- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ -->
    <div class="section">
        <h3>ğŸ“‹ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
        <div class="templates-grid">
            <div class="template-item" onclick="applyTemplate('strategy')">
                ğŸ¯<br>æˆ¦ç•¥ææ¡ˆ
            </div>
            <div class="template-item" onclick="applyTemplate('analysis')">
                ğŸ“Š<br>åˆ†æçµæœ
            </div>
            <div class="template-item" onclick="applyTemplate('proposal')">
                ğŸ’¼<br>ä¼ç”»ææ¡ˆ
            </div>
            <div class="template-item" onclick="applyTemplate('conclusion')">
                âœ…<br>çµè«–ãƒ»ã¾ã¨ã‚
            </div>
        </div>
    </div>
    
    <!-- PowerPointæ“ä½œ -->
    <div class="section">
        <h3>ğŸ”§ PowerPointæ“ä½œ</h3>
        <button class="btn btn-secondary" onclick="getCurrentSlideInfo()">ğŸ“„ ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã‚’æ›´æ–°</button>
        <button class="btn btn-secondary" onclick="exportMessages()">ğŸ’¾ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    </div>

    <script>
        let currentSlideData = {};
        let generatedMessagesData = [];
        
        // Office.js åˆæœŸåŒ–
        Office.onReady((info) => {
            if (info.host === Office.HostType.PowerPoint) {
                console.log('PowerPoint ã‚¢ãƒ‰ã‚ªãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
                showStatus('PowerPointã‚¢ãƒ‰ã‚ªãƒ³ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
                getCurrentSlideInfo();
            } else {
                showStatus('ã“ã®ã‚¢ãƒ‰ã‚ªãƒ³ã¯PowerPointã§ã®ã¿å‹•ä½œã—ã¾ã™', 'error');
            }
        });
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(message, type = 'success') {
            const statusBar = document.getElementById('statusBar');
            statusBar.textContent = message;
            statusBar.className = `status-bar ${type === 'error' ? 'error' : ''}`;
            statusBar.style.display = 'block';
            
            setTimeout(() => {
                statusBar.style.display = 'none';
            }, 3000);
        }
        
        // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã‚’å–å¾—
        async function getCurrentSlideInfo() {
            try {
                await PowerPoint.run(async (context) => {
                    const presentation = context.presentation;
                    const slides = presentation.slides;
                    const currentSlide = presentation.getSelectedSlides().getItemAt(0);
                    
                    slides.load('items/id');
                    currentSlide.load('id,shapes');
                    
                    await context.sync();
                    
                    const slideIndex = slides.items.findIndex(slide => slide.id === currentSlide.id) + 1;
                    const totalSlides = slides.items.length;
                    
                    // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
                    let slideTitle = 'ã‚¿ã‚¤ãƒˆãƒ«ãªã—';
                    const shapes = currentSlide.shapes;
                    shapes.load('items/name,items/textFrame');
                    await context.sync();
                    
                    for (let shape of shapes.items) {
                        if (shape.name.includes('Title') || shape.textFrame.hasText) {
                            shape.textFrame.load('textRange');
                            await context.sync();
                            slideTitle = shape.textFrame.textRange.text.substring(0, 50) || 'ã‚¿ã‚¤ãƒˆãƒ«ãªã—';
                            break;
                        }
                    }
                    
                    // UIæ›´æ–°
                    document.getElementById('slideNumber').textContent = slideIndex;
                    document.getElementById('totalSlides').textContent = totalSlides;
                    document.getElementById('slideTitle').textContent = slideTitle;
                    
                    currentSlideData = {
                        index: slideIndex,
                        total: totalSlides,
                        title: slideTitle,
                        id: currentSlide.id
                    };
                });
            } catch (error) {
                console.error('ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æ
        async function analyzeCurrentSlide() {
            try {
                showStatus('ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æä¸­...', 'info');
                
                await PowerPoint.run(async (context) => {
                    const currentSlide = context.presentation.getSelectedSlides().getItemAt(0);
                    const shapes = currentSlide.shapes;
                    
                    shapes.load('items/name,items/textFrame,items/type');
                    await context.sync();
                    
                    let slideContent = {
                        title: '',
                        textContent: [],
                        shapeCount: shapes.items.length
                    };
                    
                    for (let shape of shapes.items) {
                        if (shape.textFrame && shape.textFrame.hasText) {
                            shape.textFrame.load('textRange');
                            await context.sync();
                            
                            const text = shape.textFrame.textRange.text;
                            if (shape.name.includes('Title')) {
                                slideContent.title = text;
                            } else {
                                slideContent.textContent.push(text);
                            }
                        }
                    }
                    
                    displaySlideAnalysis(slideContent);
                });
                
                showStatus('ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æçµæœã‚’è¡¨ç¤º
        function displaySlideAnalysis(content) {
            const section = document.getElementById('slideAnalysisSection');
            const result = document.getElementById('slideAnalysisResult');
            
            result.innerHTML = `
                <div class="slide-preview">
                    <strong>ğŸ“ ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${content.title || 'ãªã—'}<br>
                    <strong>ğŸ“„ ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ :</strong> ${content.textContent.length}å€‹<br>
                    <strong>ğŸ”§ å›³å½¢è¦ç´ :</strong> ${content.shapeCount}å€‹<br>
                    <hr style="margin: 10px 0;">
                    <strong>ğŸ“‹ ä¸»è¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„:</strong><br>
                    ${content.textContent.slice(0, 3).map(text => `â€¢ ${text.substring(0, 50)}...`).join('<br>')}
                </div>
                <button class="btn btn-small" onclick="generateMessageFromCurrentSlide()">
                    ğŸ¯ ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
                </button>
            `;
            
            section.style.display = 'block';
        }
        
        // å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æ
        async function analyzeAllSlides() {
            try {
                showStatus('å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’åˆ†æä¸­...', 'info');
                
                await PowerPoint.run(async (context) => {
                    const presentation = context.presentation;
                    const slides = presentation.slides;
                    
                    slides.load('items');
                    await context.sync();
                    
                    let allContent = [];
                    
                    for (let i = 0; i < Math.min(slides.items.length, 10); i++) {
                        const slide = slides.items[i];
                        const shapes = slide.shapes;
                        
                        shapes.load('items/textFrame');
                        await context.sync();
                        
                        let slideTexts = [];
                        for (let shape of shapes.items) {
                            if (shape.textFrame && shape.textFrame.hasText) {
                                shape.textFrame.load('textRange');
                                await context.sync();
                                slideTexts.push(shape.textFrame.textRange.text);
                            }
                        }
                        
                        allContent.push({
                            slideNumber: i + 1,
                            texts: slideTexts
                        });
                    }
                    
                    displayAllSlidesAnalysis(allContent);
                });
                
                showStatus('å…¨ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('å…¨ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æã‚¨ãƒ©ãƒ¼:', error);
                showStatus('å…¨ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // å…¨ã‚¹ãƒ©ã‚¤ãƒ‰åˆ†æçµæœã‚’è¡¨ç¤º
        function displayAllSlidesAnalysis(allContent) {
            const section = document.getElementById('slideAnalysisSection');
            const result = document.getElementById('slideAnalysisResult');
            
            result.innerHTML = `
                <div class="slide-preview">
                    <strong>ğŸ“Š ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“åˆ†æ</strong><br>
                    <strong>ã‚¹ãƒ©ã‚¤ãƒ‰æ•°:</strong> ${allContent.length}<br>
                    <strong>ç·ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ :</strong> ${allContent.reduce((sum, slide) => sum + slide.texts.length, 0)}å€‹<br>
                    <hr style="margin: 10px 0;">
                    ${allContent.slice(0, 5).map(slide => 
                        `<div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 3px;">
                            <strong>ã‚¹ãƒ©ã‚¤ãƒ‰${slide.slideNumber}:</strong> ${slide.texts[0]?.substring(0, 40) || 'ãƒ†ã‚­ã‚¹ãƒˆãªã—'}...
                        </div>`
                    ).join('')}
                </div>
                <button class="btn btn-small" onclick="generateMessageFromAllSlides()">
                    ğŸ¯ å…¨ä½“ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
                </button>
            `;
            
            section.style.display = 'block';
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
        function generateMessage() {
            const messageType = document.getElementById('messageType').value;
            const audience = document.getElementById('targetAudience').value;
            const keywords = document.getElementById('keywords').value;
            
            showStatus('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆä¸­...', 'info');
            
            setTimeout(() => {
                const messages = createMessages(messageType, audience, keywords);
                displayGeneratedMessages(messages);
                showStatus('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            }, 1500);
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
        function createMessages(type, audience, keywords) {
            const keywordList = keywords.split(',').map(k => k.trim()).filter(k => k);
            const slideTitle = currentSlideData.title || 'ã“ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³';
            
            const audienceMap = {
                executives: 'çµŒå–¶é™£ã®çš†æ§˜',
                managers: 'ç®¡ç†è·ã®çš†æ§˜',
                team: 'ãƒãƒ¼ãƒ ã®çš†æ§˜',
                clients: 'ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®çš†æ§˜',
                stakeholders: 'ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã®çš†æ§˜'
            };
            
            const targetAudience = audienceMap[audience] || 'çš†æ§˜';
            
            const messageTemplates = {
                executive: [
                    `${targetAudience}ã«ã¨ã£ã¦ã€${slideTitle}ã¯æˆ¦ç•¥çš„ä¾¡å€¤å‰µå‡ºã®é‡è¦ãªè¦ç´ ã¨ãªã‚Šã¾ã™`,
                    `${keywordList[0] || 'æœ¬æ–½ç­–'}ã«ã‚ˆã‚Šã€çµ„ç¹”å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã‚’å®Ÿç¾ã„ãŸã—ã¾ã™`,
                    `æŠ•è³‡å¯¾åŠ¹æœã®è¦³ç‚¹ã‹ã‚‰ã€${slideTitle}ã¯æœ€å„ªå…ˆã§å®Ÿè¡Œã™ã¹ãå–ã‚Šçµ„ã¿ã§ã™`
                ],
                problem: [
                    `ç¾åœ¨ç›´é¢ã—ã¦ã„ã‚‹${keywordList[0] || 'èª²é¡Œ'}ã¯ã€çµ„ç¹”ã®ç«¶äº‰åŠ›ã«ç›´æ¥å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã¾ã™`,
                    `${slideTitle}ã§ç¤ºã•ã‚ŒãŸå•é¡Œã¯ã€æ—©æ€¥ãªå¯¾å¿œãŒå¿…è¦ãªé‡è¦äº‹é …ã§ã™`,
                    `å¸‚å ´ç’°å¢ƒã®å¤‰åŒ–ã«ã‚ˆã‚Šã€${keywordList[0] || 'ã“ã®èª²é¡Œ'}ã¸ã®å¯¾ç­–ãŒä¸å¯æ¬ ã¨ãªã£ã¦ã„ã¾ã™`
                ],
                solution: [
                    `${slideTitle}ã«ã‚ˆã‚Šã€${keywordList.join('ã€') || 'ç¾åœ¨ã®èª²é¡Œ'}ã‚’æ ¹æœ¬çš„ã«è§£æ±ºã§ãã¾ã™`,
                    `ææ¡ˆã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€${targetAudience}ã®æœŸå¾…ã‚’ä¸Šå›ã‚‹æˆæœã‚’ã‚‚ãŸã‚‰ã—ã¾ã™`,
                    `å®Ÿç¸¾ã«åŸºã¥ã„ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ç¢ºå®Ÿãªå•é¡Œè§£æ±ºã‚’å®Ÿç¾ã„ãŸã—ã¾ã™`
                ],
                benefit: [
                    `${slideTitle}ã®å®Ÿæ–½ã«ã‚ˆã‚Šã€${keywordList[0] || 'å¤§å¹…ãªæ”¹å–„'}ãŒæœŸå¾…ã§ãã¾ã™`,
                    `${targetAudience}ã«ã¨ã£ã¦ã€å…·ä½“çš„ãªãƒ¡ãƒªãƒƒãƒˆã¨ã—ã¦${keywordList.join('ã€')}ãŒå®Ÿç¾ã•ã‚Œã¾ã™`,
                    `æŠ•è³‡å›åæœŸé–“ã¯çŸ­æœŸé–“ã§ã€é•·æœŸçš„ãªç«¶äº‰å„ªä½æ€§ã‚‚ç¢ºä¿ã§ãã¾ã™`
                ],
                action: [
                    `${slideTitle}ã®å®Ÿç¾ã«å‘ã‘ã¦ã€å³åº§ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã„ãŸã—ã¾ã™`,
                    `æˆåŠŸç¢ºå®Ÿãªå®Ÿè¡Œè¨ˆç”»ã«ã‚ˆã‚Šã€${keywordList[0] || 'ç›®æ¨™'}ã‚’ç¢ºå®Ÿã«é”æˆã„ãŸã—ã¾ã™`,
                    `æ®µéšçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã€ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰æˆæœã‚’æœ€å¤§åŒ–ã—ã¾ã™`
                ],
                closing: [
                    `${targetAudience}ã®ã”æ”¯æ´ã«ã‚ˆã‚Šã€${slideTitle}ã‚’æˆåŠŸã«å°ãã“ã¨ãŒã§ãã¾ã™`,
                    `æœ¬æ—¥ã®ã”ææ¡ˆãŒã€çµ„ç¹”ã®æ›´ãªã‚‹ç™ºå±•ã®èµ·ç‚¹ã¨ãªã‚‹ã“ã¨ã‚’ç¢ºä¿¡ã—ã¦ãŠã‚Šã¾ã™`,
                    `${slideTitle}ã®æ‰¿èªã‚’ã„ãŸã ãã€å…±ã«æˆåŠŸã¸ã®é“ç­‹ã‚’æã‹ã›ã¦ãã ã•ã„`
                ]
            };
            
            return (messageTemplates[type] || messageTemplates.executive).map((text, index) => ({
                type: type,
                text: text,
                index: index
            }));
        }
        
        // ç”Ÿæˆã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function displayGeneratedMessages(messages) {
            const section = document.getElementById('generatedMessageSection');
            const container = document.getElementById('generatedMessages');
            
            generatedMessagesData = messages;
            
            container.innerHTML = messages.map((msg, index) => `
                <div class="message-card">
                    <div class="message-type">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ${index + 1}</div>
                    <div class="message-text">${msg.text}</div>
                    <div style="margin-top: 8px;">
                        <button class="btn btn-small btn-success" onclick="insertMessageToSlide('${msg.text.replace(/'/g, '\\\')}')">
                            â• ã‚¹ãƒ©ã‚¤ãƒ‰ã«æŒ¿å…¥
                        </button>
                        <button class="btn btn-small" onclick="copyToClipboard('${msg.text.replace(/'/g, '\\\')}')">
                            ğŸ“‹ ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                </div>
            `).join('');
            
            section.style.display = 'block';
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ãƒ©ã‚¤ãƒ‰ã«æŒ¿å…¥
        async function insertMessageToSlide(message) {
            if (!message && generatedMessagesData.length > 0) {
                message = generatedMessagesData[0].text;
            }
            
            try {
                await PowerPoint.run(async (context) => {
                    const currentSlide = context.presentation.getSelectedSlides().getItemAt(0);
                    
                    // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 
                    const textBox = currentSlide.shapes.addTextBox(message, {
                        left: 50,
                        top: 300,
                        width: 600,
                        height: 100
                    });
                    
                    // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®š
                    textBox.textFrame.textRange.font.size = 18;
                    textBox.textFrame.textRange.font.bold = true;
                    textBox.textFrame.textRange.font.color = '#1e3c72';
                    
                    await context.sync();
                });
                
                showStatus('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ãƒ©ã‚¤ãƒ‰ã«æŒ¿å…¥ã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æŒ¿å…¥ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æŒ¿å…¥ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŒ¿å…¥
        async function createNewSlideWithMessage() {
            if (generatedMessagesData.length === 0) {
                showStatus('ã¾ãšãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                await PowerPoint.run(async (context) => {
                    const presentation = context.presentation;
                    
                    // æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¿½åŠ 
                    const newSlide = presentation.slides.add(PowerPoint.SlideLayoutType.titleAndContent);
                    
                    // ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š
                    newSlide.shapes.getItemAt(0).textFrame.textRange.text = 'ã‚­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸';
                    
                    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
                    const message = generatedMessagesData[0].text;
                    newSlide.shapes.getItemAt(1).textFrame.textRange.text = message;
                    
                    // æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’é¸æŠ
                    newSlide.select();
                    
                    await context.sync();
                });
                
                showStatus('æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆã—ã¾ã—ãŸ', 'success');
                getCurrentSlideInfo(); // ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã‚’æ›´æ–°
            } catch (error) {
                console.error('æ–°ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                showStatus('æ–°ã—ã„ã‚¹ãƒ©ã‚¤ãƒ‰ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨
        function applyTemplate(templateType) {
            const templates = {
                strategy: {
                    messageType: 'executive',
                    audience: 'executives',
                    keywords: 'æˆ¦ç•¥,ç«¶äº‰å„ªä½,æˆé•·,å¤‰é©'
                },
                analysis: {
                    messageType: 'problem',
                    audience: 'managers',
                    keywords: 'åˆ†æ,èª²é¡Œ,æ”¹å–„,æœ€é©åŒ–'
                },
                proposal: {
                    messageType: 'solution',
                    audience: 'stakeholders',
                    keywords: 'ææ¡ˆ,ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³,å®Ÿè£…,åŠ¹æœ'
                },
                conclusion: {
                    messageType: 'closing',
                    audience: 'executives',
                    keywords: 'ã¾ã¨ã‚,æ±ºå®š,å®Ÿè¡Œ,æˆåŠŸ'
                }
            };
            
            const template = templates[templateType];
            if (template) {
                document.getElementById('messageType').value = template.messageType;
                document.getElementById('targetAudience').value = template.audience;
                document.getElementById('keywords').value = template.keywords;
                
                showStatus(`${templateType}ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ã—ã¾ã—ãŸ`, 'success');
            }
        }
        
        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showStatus('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                showStatus('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
        function generateMessageFromCurrentSlide() {
            document.getElementById('keywords').value = currentSlideData.title || 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³';
            generateMessage();
        }
        
        // å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
        function generateMessageFromAllSlides() {
            document.getElementById('keywords').value = 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“,çµ±åˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸,ç·åˆææ¡ˆ';
            generateMessage();
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportMessages() {
            if (generatedMessagesData.length === 0) {
                showStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            const exportText = generatedMessagesData.map((msg, index) => 
                `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ${index + 1}: ${msg.text}`
            ).join('\n\n');
            
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'powerpoint_key_messages.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            showStatus('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            // å®šæœŸçš„ã«ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±ã‚’æ›´æ–°
            setInterval(getCurrentSlideInfo, 10000); // 10ç§’ã”ã¨
        });
    </script>
</body>
</html>